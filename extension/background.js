!function(t){function e(e){for(var r,s,i=e[0],c=e[1],l=e[2],f=0,d=[];f<i.length;f++)s=i[f],Object.prototype.hasOwnProperty.call(a,s)&&a[s]&&d.push(a[s][0]),a[s]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(t[r]=c[r]);for(u&&u(e);d.length;)d.shift()();return o.push.apply(o,l||[]),n()}function n(){for(var t,e=0;e<o.length;e++){for(var n=o[e],r=!0,i=1;i<n.length;i++){var c=n[i];0!==a[c]&&(r=!1)}r&&(o.splice(e--,1),t=s(s.s=n[0]))}return t}var r={},a={2:0},o=[];function s(e){if(r[e])return r[e].exports;var n=r[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=t,s.c=r,s.d=function(t,e,n){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)s.d(n,r,function(e){return t[e]}.bind(null,r));return n},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="";var i=window.webpackJsonp=window.webpackJsonp||[],c=i.push.bind(i);i.push=e,i=i.slice();for(var l=0;l<i.length;l++)e(i[l]);var u=c;o.push([510,1,0]),n()}({510:function(t,e,n){"use strict";n.r(e);var r=n(29),a=n(5),o=n(8);class s extends Error{constructor(t,e,n){super(t),this.name=this.constructor.name,this.code=e,this.timestamp=Date.now(),this.context=n,Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}toJSON(){return{name:this.name,message:this.message,code:this.code,timestamp:this.timestamp,context:this.context,stack:this.stack}}}class i extends s{constructor(t,e=o.a.UNKNOWN_ERROR,n){super(t,e,n)}}function c(t){return function(t){return t instanceof s}(t)?t:t instanceof Error?new i(t.message,o.a.UNKNOWN_ERROR,{originalError:t.name,stack:t.stack}):new i(String(t),o.a.UNKNOWN_ERROR,{originalError:t})}const l=Object(r.c)("Background"),u=new r.a,f=new r.b("local"),d=Object(r.d)(),g={isReady:!1,config:null,stakerIntervalId:null,isProcessing:!1,lastError:null,retryCount:0,maxRetries:3};async function p(){try{l.info("Initializing background script"),await async function(){try{const t=await f.get(o.c.config);t?(g.config=t,l.info("Configuration loaded from storage")):l.warn("No configuration found in storage, using default")}catch(t){throw l.error("Failed to load configuration from storage",t),t}}(),chrome.storage.onChanged.addListener((t,e)=>{if("local"===e&&t[o.c.config]){const e=t[o.c.config].newValue,n=t[o.c.config].oldValue;g.config=e,null!==g.stakerIntervalId&&n&&e&&(l.info("Configuration changed, restarting autostaker..."),h(),m())}}),d.onMessage(async t=>{l.debug("Received message: "+t.type);try{switch(t.type){case a.a.AUTOSTAKER_ON:await async function(){if(!g.config)throw new Error("No configuration available");null===g.stakerIntervalId?await m():l.info("Autostaker already running")}();break;case a.a.AUTOSTAKER_OFF:await async function(){null!==g.stakerIntervalId?h():l.info("Autostaker not running")}();break;default:l.warn("Unknown message type: "+t.type)}}catch(t){l.error("Error handling message",t),y(t)}}),g.isReady=!0,l.info("Background script initialized successfully");const t=await f.get(o.c.runtime);(null==t?void 0:t.isStakerActive)&&g.config&&(l.info("Resuming autostaker from previous session"),await m())}catch(t){l.fatal("Failed to initialize background script",t),g.lastError=c(t)}}async function m(){if(!g.config)throw new Error("Cannot start autostaker without configuration");try{l.info("Starting autostaker..."),await u.initialize(g.config),await w();const t=60*g.config.checkIntervalMinutes*1e3;g.stakerIntervalId=setInterval(w,t),l.info(`Autostaker started (interval: ${g.config.checkIntervalMinutes} minutes)`)}catch(t){throw l.error("Failed to start autostaker",t),g.lastError=c(t),y(t),t}}function h(){l.info("Stopping autostaker..."),null!==g.stakerIntervalId&&(clearInterval(g.stakerIntervalId),g.stakerIntervalId=null),u.stop(),g.isProcessing=!1,l.info("Autostaker stopped")}async function w(){if(g.isProcessing)l.info("Staker process already running, skipping...");else{g.isProcessing=!0;try{l.info("Running staker process...");const t=await u.getRewardsToClaim();await u.process();const e=await u.getRewardsToClaim();!function(t,e){const n={type:a.a.UPDATE_REWARDS,payload:{rewardsToClaim:t,totalValueUst:e}};d.sendMessage(n)}(e,await u.getTotalValueUst()),await k({lastCheckTime:Date.now(),nextCheckTime:Date.now()+60*g.config.checkIntervalMinutes*1e3,error:null}),l.info("Staker process completed successfully"),l.info(`Rewards: ${t} -> ${e}`)}catch(t){l.error("Staker process failed",t),g.lastError=c(t),y(t),await k({error:{code:"STAKER_PROCESS_ERROR",message:t.message,timestamp:Date.now(),details:t}})}finally{g.isProcessing=!1}}}function y(t){const e={type:a.a.ERROR,payload:{code:"BACKGROUND_ERROR",message:t.message,timestamp:Date.now(),details:t}};d.sendMessage(e)}async function k(t){try{const e=await f.get(o.c.runtime)||{},n=Object.assign(Object.assign({},e),t);await f.set(o.c.runtime,n)}catch(t){l.error("Failed to update runtime state",t)}}chrome.runtime.onStartup.addListener(()=>{console.log("[Background] Extension started"),p()}),chrome.runtime.onInstalled.addListener(t=>{if(console.log("[Background] Extension installed:",t.reason),"install"===t.reason){const t={seedPhrase:"",targetAsset:a.d.mETH,checkIntervalMinutes:60,contractExecDelaySeconds:15,mnemonicIndex:0,coinType:330,gasPrice:.3,lcdUrl:"https://lcd.terra.dev",network:a.b.MAINNET};f.set(o.c.config,t)}p()}),p()}});
//# sourceMappingURL=background.js.map